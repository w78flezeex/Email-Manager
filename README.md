# Email Manager

Система массовой рассылки email с веб-интерфейсом управления.

## Возможности

- Импорт email адресов из SQL дампов
- Массовая отправка email через API smtp.bz
- Веб-интерфейс для управления рассылками
- Отслеживание статистики доставки
- Автоматическое управление очередью
- Поиск по email адресам
- Детальное логирование

## Требования

- PHP 7.4+
- MySQL/MariaDB
- cURL расширение для PHP
- PDO расширение для PHP

## Установка

1. Скачайте репозиторий в директорию веб-сервера
2. Создайте базу данных MySQL
3. Настройте параметры в `config.php`
4. Запустите `install.php` в браузере
5. Импортируйте email адреса через веб-интерфейс

## Конфигурация

Отредактируйте `config.php`:

```php
// API ключ smtp.bz
define('SMTP_API_KEY', 'your_api_key_here');

// Настройки базы данных
define('DB_HOST', 'localhost');
define('DB_NAME', 'email_tracker');
define('DB_USER', 'root');
define('DB_PASS', '');

// Настройки отправки
define('EMAILS_PER_HOUR', 50);
define('SENDER_EMAIL', 'your@email.com');
define('SENDER_NAME', 'Your Name');
```

## Использование

### Веб-интерфейс

Откройте `index.php` в браузере для панели управления:

- Просмотр статистики
- Импорт email адресов
- Отправка тестовых писем
- Поиск по базе данных
- Просмотр логов

### Автоматическая отправка

Настройте cron для автоматической отправки каждый час:

```bash
0 * * * * /usr/bin/php /path/to/your/project/cron.php
```

### API

Отправка партии писем через API:
```
GET /emailer.php?action=send_batch
```

## Структура файлов

- `index.php` - Главная страница с веб-интерфейсом
- `config.php` - Конфигурация системы
- `database.php` - Класс управления базой данных
- `emailer.php` - Класс отправки email
- `cron.php` - Скрипт автоматической отправки
- `install.php` - Скрипт установки
- `preview.php` - Предварительный просмотр письма
- `cleanup.php` - Утилита очистки базы данных
- `logs/` - Директория логов

## Схема базы данных

### email_queue
- `id` - Уникальный идентификатор
- `email` - Email адрес
- `username` - Имя пользователя
- `discord_id` - Discord ID (опционально)
- `status` - Статус (`pending`, `sent`, `failed`, `retry`)
- `attempts` - Количество попыток отправки
- `last_attempt` - Время последней попытки
- `sent_at` - Время отправки
- `error_message` - Сообщение об ошибке
- `created_at` - Время создания

### email_stats
- `total_emails` - Общее количество email
- `sent_emails` - Количество отправленных
- `failed_emails` - Количество неудачных
- `pending_emails` - Количество в очереди
- `last_batch_sent` - Время последней отправки партии

## Обработка ошибок

Интеллектуальная система определения ошибок:

- **Постоянные ошибки**: Несуществующие ящики, заблокированные аккаунты (без повтора)
- **Временные ошибки**: Проблемы сервера, лимиты (повтор с задержкой)
- **Авто-очистка**: Удаляет постоянно недоставляемые адреса

## Логирование

Система детального логирования:

- `logs/email_log.txt` - Основной лог отправки
- `logs/error_log.txt` - Лог ошибок
- `logs/cron_log.txt` - Лог выполнения cron

## Безопасность

- Подготовленные SQL запросы
- Валидация email адресов
- Защищенный доступ к логам
- Безопасное управление конфигурацией

## Лицензия

MIT License